<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adding a new geography layer • geodato</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Adding a new geography layer">
<meta property="og:description" content="geodato">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geodato</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/new-geography-layer.html">Adding a new geography layer</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adding a new geography layer</h1>
            
      
      
      <div class="hidden name"><code>new-geography-layer.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodato</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="procedimiento-para-la-carga-de-una-nueva-capa-geográfica-al-paquete-geodato">Procedimiento para la carga de una nueva capa geográfica al paquete
geodato<a class="anchor" aria-label="anchor" href="#procedimiento-para-la-carga-de-una-nueva-capa-geogr%C3%A1fica-al-paquete-geodato"></a>
</h2>
<p>El paquete geodato ofrece un conjunto de capas geográficas para
trabajar con mapas. En caso de necesitar trabajar con una capa
geográfica que no está contemplada en el paquete, se pueden seguir los
siguientes pasos para cargar y disponibilizar una nueva:</p>
<div class="section level3">
<h3 id="estructura-de-carpetas-donde-alojar-las-geografías">Estructura de carpetas donde alojar las geografías<a class="anchor" aria-label="anchor" href="#estructura-de-carpetas-donde-alojar-las-geograf%C3%ADas"></a>
</h3>
<p>El conjunto de capas geográficas disponibles en el paquete se alojan
en la carpeta <code>data-raw/</code>. Al interior de la misma, se podrán
distinguir dos subcarpetas:</p>
<ul>
<li><p>La primera llamada <code>files/</code>, que será el espacio de
trabajo con la información cruda de las capas a agregar.</p></li>
<li><p>La segunda llamada <code>gedato/</code>. Allí se alojarán los
archivos finales disponibles para usuarios y usuarias.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="carga-de-una-nueva-capa-geográfica-en-files">Carga de una nueva capa geográfica en <code>files/</code><a class="anchor" aria-label="anchor" href="#carga-de-una-nueva-capa-geogr%C3%A1fica-en-files"></a>
</h3>
<ol style="list-style-type: decimal">
<li>El primer paso es crear la carpeta del país y la división geográfica
de la cual se quiere cargar la capa. Para ello se puede correr la
función <code>create_files_folder()</code> quien, previo a crear la
carpeta, va a revisar si la misma ya existe (tanto a nivel país como
subregión).</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">create_files_folder</span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Argentina"</span>, </span>
<span>                    geo_divisiont <span class="op">=</span> <span class="st">"Department"</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>El segundo paso es cargar la capa geográfica. El formato para
trabajar la geometría debe ser <strong>topoJSON</strong> (a diferencia
del GeoJSON, este formato es mucho más compacto) por lo que es necesario
o bien cargar de forma manual la capa geográfica en esta extensión
dentro de la carpeta creada o realizar el procesamiento necesario para
ello. En caso de esto último, lo óptimo es crear un
<strong>script.R</strong> con el paso a paso para garantizar la
reproducibilidad del proceso. La función
<code>create_files_folder()</code> asiste en ello creando una versión
vacía del script.</li>
</ol>
<p>Una vez cargada la capa en la carpeta correspondiente se debe
garantizar que entre las propiedades del archivo topoJSON que contienen
el <strong>id</strong> de la división y su <strong>etiqueta</strong>
deben llamarse <code>id</code> y <code>name</code> respectivamente
(modificar en caso de que así no sea) y que al mismo tiempo los valores
de sus códigos de referencia se correspondan con los del sistema
estadístico oficial del país en cuestión.</p>
</div>
<div class="section level3">
<h3 id="carga-de-una-nueva-capa-geográfica-en-geodato">Carga de una nueva capa geográfica en <code>geodato/</code><a class="anchor" aria-label="anchor" href="#carga-de-una-nueva-capa-geogr%C3%A1fica-en-geodato"></a>
</h3>
<p>Dentro de la carpeta geodato se debe crear una carpeta con el código
ISO del país al que pertenece la división geográfica que se desea
agregar en el paquete. A continuación, dentro de esa carpeta, se crea
una subcarpeta cuyo nombre debe seguir el siguiente formato:</p>
<div class="section level4">
<h4 id="estructura-carpeta-geodato">Estructura carpeta geodato<a class="anchor" aria-label="anchor" href="#estructura-carpeta-geodato"></a>
</h4>
<p><strong><code>&lt;carpeta_principal&gt;_&lt;iso_entidad&gt;_&lt;nombre_división_administrativa&gt;</code></strong>.</p>
<p>Por ejemplo, si se quiere agregar el mapa de una ciudad de México, se
agrega la carpeta con el ISO del país, el sufijo de esa ciudad y la
división geográfica correspondiente al topojson que desea guardar.
Supongamos que es la Ciudad de México (CDMX) y la división geográfica
que se va a guardar es “alcaldías” (dejando el término en inglés como
“mayors”). Entonces, el nombre de la carpeta sería mex_cdmx_mayors. Los
siguientes pasos son:</p>
<ul>
<li><p>ejecutar la función <code><a href="../reference/write_topojson.html">write_topojson()</a></code> sobre el
archivo topoJSON original (en la carpeta <code>files/</code>) y guardar
el output en la carpeta <code>geodato/</code></p></li>
<li><p>ejecutar la función <code><a href="../reference/centroids_from_topojson.html">centroids_from_topojson()</a></code> para
calcular y guardar los centroides de la geografía en la carpeta
<code>geodato/</code></p></li>
</ul>
<p>al final, la carpeta <code>geodato/</code> debe contener los
siguientes archivos:</p>
<ul>
<li>El archivo TopoJSON del mapa.</li>
<li>Los centroides de las regiones.</li>
<li>Un archivo meta.yaml que contenga la información necesaria sobre la
división geográfica.</li>
</ul>
<p>Opcionalmente puede guardar otras tablas con nombres alternativos y
regiones. La estructura de estos datos será definida durante el
desarrollo del documento.</p>
</div>
</div>
<div class="section level3">
<h3 id="configuración-archivo-meta-yaml">Configuración archivo meta.yaml<a class="anchor" aria-label="anchor" href="#configuraci%C3%B3n-archivo-meta-yaml"></a>
</h3>
<p>El archivo meta.yaml contiene información general y descriptiva de
las propiedades del mapa que desea adjuntar. A continuación se explican
las distintas secciones que debe contener:</p>
<div class="section level4">
<h4 id="label">label<a class="anchor" aria-label="anchor" href="#label"></a>
</h4>
<p>Es la etiqueta o el nombre descriptivo del mapa</p>
</div>
<div class="section level4">
<h4 id="centroids_file">centroids_file<a class="anchor" aria-label="anchor" href="#centroids_file"></a>
</h4>
<p>Indica la ruta que contiene una base de datos que relaciona los
identificadores y el nombre de las divisiones geográficas del mapa con
sus centros.</p>
<p>La estructura del archivo csv debe ser la siguiente:</p>
<table class="table">
<thead><tr class="header">
<th>id</th>
<th>name</th>
<th>lat</th>
<th>lon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>nombre 1</td>
<td>-1.92</td>
<td>-71.98</td>
</tr>
<tr class="even">
<td>2</td>
<td>nombre 2</td>
<td>7.14</td>
<td>-75.58</td>
</tr>
<tr class="odd">
<td>3</td>
<td>nombre 3</td>
<td>6.28</td>
<td>-70.73</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Las columnas id y name incluyen los códigos y nombres de cada
división geográfica que deben coincidir con el sistema estadístico
nacional. Las columnas lat y lon incluyen las coordenadas geográficas
(latitud y longitud) del centroide de cada región.</p>
</div>
<div class="section level4">
<h4 id="altnames_file-opcional">altnames_file (opcional)<a class="anchor" aria-label="anchor" href="#altnames_file-opcional"></a>
</h4>
<p>Indica la ruta donde se encuentra el archivo con la base de datos que
relaciona los códigos oficiales del sistema estadístico nacional del
mapa documentado para cada una de las divisiones geográficas del mapa, y
los posibles nombres que pueden tomar estos códigos. La estructura del
archivo debe ser la siguiente (ejemplo ilustrativo, el id no corresponde
con el código oficial del DANE)</p>
<table class="table">
<thead><tr class="header">
<th>id</th>
<th>altname</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Amazonas</td>
</tr>
<tr class="even">
<td>1</td>
<td>Departamento de Amazonas</td>
</tr>
<tr class="odd">
<td>1</td>
<td>Amazonas (Colombia)</td>
</tr>
<tr class="even">
<td>2</td>
<td>Antioquia</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Departamento de Antioquia</td>
</tr>
<tr class="even">
<td>2</td>
<td>Antioquia (Colombia)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Arauca</td>
</tr>
<tr class="even">
<td>3</td>
<td>Departamento de Arauca</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Arauca (Colombia)</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Es importante destacar que cada id puede tener múltiples nombres
alternativos asociados, por lo que cada código se repetirá tantas veces
como nombres alternativos tenga.</p>
</div>
<div class="section level4">
<h4 id="level">level<a class="anchor" aria-label="anchor" href="#level"></a>
</h4>
<p>El nivel de detalle del mapa se define mediante la variable level,
que hace referencia al nivel de administración o ADM. Los ADM se
utilizan para clasificar los límites administrativos y los datos
geográficos asociados con ellos.</p>
<p>A continuación se describen los ADM más comunes y su aplicación:</p>
<ul>
<li>ADM0: Este nivel se utiliza para hacer referencia al país completo o
a una región más grande que lo incluya todo.</li>
<li>ADM1: Este nivel se utiliza para dividir el país en regiones más
grandes, que pueden llamarse departamentos, provincias, estados,
regiones o cualquier otro nombre que se ajuste a la división geográfica
específica del país. Ejemplo: en el caso de Colombia, los departamentos
se definen como ADM1.</li>
<li>ADM2: Este nivel se utiliza para dividir las regiones más grandes en
sub-regiones o unidades más pequeñas, que pueden llamarse municipios,
cantones, distritos, entre otros. Ejemplo: en el caso de Colombia, los
municipios se definen como ADM2.</li>
<li>ADM3: Este nivel se utiliza para dividir las unidades más pequeñas
en subdivisiones aún más pequeñas.</li>
</ul>
</div>
<div class="section level4">
<h4 id="regions_file-opcional">regions_file (opcional)<a class="anchor" aria-label="anchor" href="#regions_file-opcional"></a>
</h4>
<p>Indica la ruta donde se encuentra el archivo con las regiones en las
que se puede dividir el mapa que se está caracterizando, este archivo
debe ser una tabla cuyos nombres de columna deben ser region_code,
region_name, id y name.</p>
<p>La columna region_code debe contener el código único de cada región
del mapa. La columna region_name debe contener el nombre de cada región
del mapa. Las columnas id y name incluyen los códigos y nombres de cada
división geográfica que deben coincidir con el sistema estadístico
nacional.</p>
<p>Ejemplo de La estructura del archivo:</p>
<table class="table">
<thead><tr class="header">
<th>region_code</th>
<th>region_name</th>
<th>id</th>
<th>name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>orinoquia</td>
<td>Orinoquia</td>
<td>50</td>
<td>META</td>
</tr>
<tr class="even">
<td>pacifico</td>
<td>Pacifico</td>
<td>50</td>
<td>NARIÑO</td>
</tr>
<tr class="odd">
<td>andina</td>
<td>Andina</td>
<td>54</td>
<td>NORTE DE SANTANDER</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Es importante destacar que el identificador de cada región debe ser
único y consistente con los archivos altnames_file y centroids_file.</p>
</div>
<div class="section level4">
<h4 id="parent_map_name">parent_map_name<a class="anchor" aria-label="anchor" href="#parent_map_name"></a>
</h4>
<p>Si el mapa caracterizado tiene un nivel de administración superior a
ADM1, se debe poner el nombre del mapa que contiene la división
geográfica ADM1, por ejemplo: para Colombia el meta.yaml de Municipios
contiene su “padre” que es Departamentos.</p>
</div>
<div class="section level4">
<h4 id="id_format">id_format<a class="anchor" aria-label="anchor" href="#id_format"></a>
</h4>
<p>Indica por medio de una expresión regular el formato del código
oficial del sistema estadístico nacional al que corresponda el mapa
ingresado, por ejemplo: En caso de que el código de identificación fuera
un string, como en el caso del ISO3 utilizado para los países del mundo
(“ARG”, “COL”, “BRA”, etc.), se podría utilizar la siguiente expresión
regular para indicar el formato del código:</p>
<p><code>id_format: "^[A-Z]{3}$"</code></p>
<p>En este ejemplo, la expresión regular <code>^[A-Z]{3}$</code> indica
que el código debe estar compuesto por tres letras mayúsculas.</p>
<p>En caso de que el código de identificación fuera un número, pero no
tuviera un número fijo de dígitos, se podría utilizar la siguiente
expresión regular para indicar el formato del código:</p>
<p><code>id_format: "^\d+$"</code></p>
<p>En este ejemplo, la expresión regular <code>^\d+$</code> indica que
el código debe estar compuesto por uno o más dígitos.</p>
<p>Es importante destacar que el formato de identificación debe ser
consistente con los archivos altnames_file, centroids_file y
regions_file.</p>
</div>
<div class="section level4">
<h4 id="code_cols">code_cols<a class="anchor" aria-label="anchor" href="#code_cols"></a>
</h4>
<p>Arreglo de posibles nombres que pueden llegar a tener las variables
que contienen el código oficial del sistema estadístico nacional.</p>
</div>
<div class="section level4">
<h4 id="name_cols">name_cols<a class="anchor" aria-label="anchor" href="#name_cols"></a>
</h4>
<p>Arreglo de posibles nombres que pueden llegar a tener las variables
que contienen el nombre oficial del sistema estadístico nacional.</p>
</div>
<div class="section level4">
<h4 id="topojson">topojson<a class="anchor" aria-label="anchor" href="#topojson"></a>
</h4>
<p>Lista con las siguientes caracteristicas:</p>
<ul>
<li><p>scope: Corresponde al área geográfica que se muestra en el mapa,
el scope se utiliza para ‘recortar’ el mapa y mostrar sólo la porción
del territorio que se desea visualizar. Un ejemplo es meta.yaml de
departamentos de Colombia, el scope se define como depto, lo que
significa que se mostrarán solamente los departamentos de Colombia en el
mapa.</p></li>
<li><p>geographyName: nombre del objeto en el archivo topojson que
contiene los nombres de las divisiones geográficas.</p></li>
<li><p>geographyId: nombre del objeto en el archivo topojson que
contiene el geocode o indicador de las divisiones geográficas.</p></li>
<li><p>path: ruta que contiene el mapa en formato TopoJSON.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="projections">projections<a class="anchor" aria-label="anchor" href="#projections"></a>
</h4>
<p>Las proyecciones en mapas se utilizan para convertir la superficie
curva de la Tierra en una superficie plana para que se pueda visualizar
en un mapa. Una proyección en mapa define cómo se mapea la superficie de
la Tierra en un plano y cuáles son las distorsiones que se producen. El
archivo YAML puede contener información sobre las distintas proyecciones
que se desean realizar del mapa caracterizado, se debe ingresar en
nombre de la proyección y definir los parámetros: centro, rotación,
escala y traslación, a continuación una breve descripción de cada
uno:</p>
<ul>
<li><p>Centro: El centro de la proyección define el punto en el que se
enfoca la vista del mapa. Este punto suele ser el centro de la región
que se desea representar. Por ejemplo, en el caso de Colombia, el centro
se ha definido como [-73.5, 4.2], lo que significa que el centro del
mapa se encuentra en la longitud -73.5 y la latitud 4.2.</p></li>
<li><p>Rotación: La rotación de la proyección define el ángulo en que se
gira el mapa en relación con su posición original. La rotación se
expresa en grados y puede ser útil para mostrar ciertas regiones del
mundo en ángulos más adecuados para su visualización. En el ejemplo de
Colombia, la rotación se ha definido como [0, 0], lo que significa que
el mapa no se ha girado.</p></li>
<li><p>Escala: La escala de la proyección define la relación entre las
distancias en el mapa y las distancias en la realidad. La escala se
puede expresar como una fracción, un porcentaje o una relación numérica.
Por ejemplo, una escala de 1:100,000 significa que una unidad en el mapa
representa 100,000 unidades en la realidad. En el ejemplo de Colombia,
la escala se ha definido como 1.8, lo que significa que el mapa está
ampliado en un 80% en comparación con el tamaño original.</p></li>
<li><p>Traslación: La traslación de la proyección define el
desplazamiento del mapa en relación con su posición original. La
traslación se puede expresar en píxeles o en coordenadas geográficas. En
el ejemplo de Colombia, la traslación se ha definido como [0,0], lo que
significa que el mapa no se ha desplazado.</p></li>
</ul>
<p>Puede agregar más propiedades de su proyección si es necesario</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Juan Pablo Marin Diaz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
